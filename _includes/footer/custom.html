<!-- start custom footer snippets -->

<a href="/sitemap/">Sitemap</a>

<!-- Support for MatJax -->
<script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
<script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script"></script>

<!-- Support for Plotly -->
<script defer src='https://cdnjs.cloudflare.com/ajax/libs/plotly.js/3.0.1/plotly.min.js'></script>

<!-- Support for Mermaid -->
<script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
    mermaid.initialize({startOnLoad:true, theme:'default'});
    await mermaid.run({querySelector:'code.language-mermaid'});
</script>

<!-- 方向感知滚动淡入效果 -->
<script>
window.addEventListener('load', function() {
  let lastScrollTop = window.pageYOffset || document.documentElement.scrollTop;
  let scrollDirection = 'down';
  
  // 监听滚动方向
  window.addEventListener('scroll', function() {
    const currentScrollTop = window.pageYOffset || document.documentElement.scrollTop;
    scrollDirection = currentScrollTop > lastScrollTop ? 'down' : 'up';
    lastScrollTop = currentScrollTop;
  }, { passive: true });
  
  // 获取所有需要动画的元素
  const elements = document.querySelectorAll(
    '.page__content h1, .page__content h2, .page__content h3, .page__content h4, ' +
    '.page__content > p, .page__content > ul, .page__content > ol, ' +
    '.page__content > div, .page__content section, ' +
    '.archive__item, .list__item'
  );
  
  // 设置初始状态
  elements.forEach(el => {
    el.style.setProperty('opacity', '0', 'important');
    el.style.setProperty('transform', 'translateY(30px)', 'important');
    el.style.setProperty('transition', 'opacity 0.8s ease, transform 0.8s ease', 'important');
  });
  
  // 创建观察器
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      const el = entry.target;
      
      if (entry.isIntersecting) {
        // 进入视口：根据滚动方向设置起始位置
        
        // 第1步：关闭过渡，设置起始位置
        el.style.setProperty('transition', 'none', 'important');
        el.style.setProperty('opacity', '0', 'important');
        
        if (scrollDirection === 'down') {
          el.style.setProperty('transform', 'translateY(30px)', 'important');
        } else {
          el.style.setProperty('transform', 'translateY(-30px)', 'important');
        }
        
        // 第2步：强制重绘
        el.offsetHeight;
        
        // 第3步：开启过渡，淡入
        el.style.setProperty('transition', 'opacity 0.8s ease, transform 0.8s ease', 'important');
        el.style.setProperty('opacity', '1', 'important');
        el.style.setProperty('transform', 'translateY(0)', 'important');
        
      } else {
        // 离开视口：根据滚动方向淡出
        el.style.setProperty('opacity', '0', 'important');
        
        if (scrollDirection === 'down') {
          el.style.setProperty('transform', 'translateY(30px)', 'important');
        } else {
          el.style.setProperty('transform', 'translateY(-30px)', 'important');
        }
      }
    });
  }, {
    threshold: 0.15,
    rootMargin: '0px 0px -100px 0px'
  });
  
  elements.forEach(el => observer.observe(el));
});
</script>

<!-- end custom footer snippets -->
